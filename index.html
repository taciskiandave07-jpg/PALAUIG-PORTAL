<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADULLAM BIBLE BAPTIST CHURCH- PALAUIG MISSION</title>
    <style>
        :root { 
            --navy: #001f3f; --gold: #d4af37; --white: #ffffff; 
            --danger: #e74c3c; --success: #27ae60; --tithe: #2c3e50;
        }
        
        body { font-family: 'Georgia', serif; margin: 0; background: var(--navy); color: #333; min-height: 100vh; }

        .bg-pattern {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-color: var(--navy);
            background-image: linear-gradient(90deg, transparent 95%, rgba(212,175,55,0.05) 95%);
            background-size: 45px 100%;
        }

        header { 
            background: linear-gradient(to bottom, #001f3f, #002b55); 
            color: var(--gold); padding: 30px 5%; text-align: center;
            border-bottom: 4px double var(--gold);
        }
        
        .pastor-name { font-size: 1.2rem; color: white; letter-spacing: 2px; margin-top: 10px; font-weight: bold; }

        nav { background: var(--white); display: flex; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.4); position: sticky; top: 0; z-index: 100; }
        .nav-link { padding: 15px 20px; color: var(--navy); font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; transition: 0.3s; }
        .nav-link:hover { color: var(--gold); background: #f4f4f4; }

        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .card { 
            background: white; padding: 30px; border-radius: 4px; margin-bottom: 25px; 
            border: 1px solid var(--gold); position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        /* Fund Buttons Grid */
        .fund-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; }
        
        .btn { 
            padding: 12px; border: none; cursor: pointer; font-weight: bold; 
            text-transform: uppercase; font-size: 0.75rem; transition: 0.2s; border-radius: 4px;
        }
        .btn:active { transform: scale(0.95); }
        .btn-tithe { background: #2c3e50; color: white; }
        .btn-offering { background: #27ae60; color: white; }
        .btn-mission { background: #8e44ad; color: white; }
        .btn-lot { background: #d35400; color: white; }
        .btn-anniv { background: #c0392b; color: white; }
        .btn-download { background: var(--navy); color: var(--gold); border: 1px solid var(--gold); width: 100%; margin-bottom: 20px; font-size: 1rem; }

        table { width: 100%; border-collapse: collapse; }
        th { background: var(--navy); color: var(--gold); padding: 12px; font-size: 0.8rem; }
        td { padding: 10px; border-bottom: 1px solid #eee; }

        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; font-family: inherit; }
        .hidden { display: none; }
        .cross-icon { color: var(--gold); font-size: 2rem; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <div id="auth-screen">
        <div class="card" style="max-width: 350px; margin: 100px auto; text-align: center;">
            <div class="cross-icon">‚úù</div>
            <h1 style="color:var(--navy); margin:0;">ABBC PORTAL</h1>
            <div style="color:var(--gold); font-weight:bold; margin-bottom:20px;">"ROOTS TO FRUITS"</div>
            <input type="text" id="log-name" placeholder="Name">
            <input type="password" id="log-pass" placeholder="Password">
            <button class="btn btn-tithe" style="width:100%" onclick="handleLogin()">Login</button>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <header>
            <div style="font-size: 2.2rem; font-weight: bold; letter-spacing: 5px;">ADULLAM BIBLE BAPTIST CHURCH PALAUIG</div>
            <div class="pastor-name">""ROOTS TO FRUITS""</div>
            <div style="color:white; font-size: 0.8rem; margin-top:5px; opacity:0.7;">"Preaching the Unsearchable Riches of Christ"</div>
        </header>
        
        <nav>
            <div class="nav-link" onclick="showTab('home')">Home</div>
            <div class="nav-link" onclick="showTab('giving')">My Record</div>
            <div class="nav-link admin-only" onclick="showTab('admin')">Church Office</div>
            <div class="nav-link" onclick="location.reload()">Logout</div>
        </nav>

        <div class="container">
            <div id="tab-home" class="tab-content">
                <div class="card" style="text-align:center;">
                    <h2 style="color:var(--navy);">HAVE A BLESSED DAY!</h2>
                    <p id="verse-display" style="font-style:italic; font-size:1.2rem;">"But my God shall supply all your need according to his riches in glory by Christ Jesus." - Philippians 4:19</p>
                </div>
            </div>

            <div id="tab-giving" class="tab-content hidden">
                <div class="card">
                    <h2 style="color:var(--navy); text-align:center;">Stewardship History</h2>
                    <button class="btn btn-download" onclick="downloadGivingCSV()">üì• Export to Excel (CSV)</button>
                    <table>
                        <thead><tr><th>Date</th><th>Category</th><th>Amount</th></tr></thead>
                        <tbody id="giving-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-admin" class="tab-content hidden">
                <div class="card">
                    <h3 style="color:var(--navy); border-bottom: 2px solid var(--gold); padding-bottom:10px;">Process Contribution</h3>
                    <label>Select Member:</label>
                    <select id="adm-member"></select>
                    
                    <label>Enter Amount (‚Ç±):</label>
                    <input type="number" id="adm-amt" placeholder="0.00">
                    
                    <div style="margin-top:20px; font-weight:bold; font-size:0.8rem; color:var(--navy);">SAVE TO SPECIFIC FUND:</div>
                    <div class="fund-grid">
                        <button class="btn btn-tithe" onclick="processEntry('Tithes')">Save Tithes</button>
                        <button class="btn btn-offering" onclick="processEntry('Offering')">Save Offering</button>
                        <button class="btn btn-mission" onclick="processEntry('Mission')">Save Mission</button>
                        <button class="btn btn-lot" onclick="processEntry('Lot Fund')">Save Lot Fund</button>
                        <button class="btn btn-anniv" onclick="processEntry('Anniversary')">Save Anniversary</button>
                    </div>
                </div>

                <div class="card">
                    <h3 style="color:var(--navy); border-bottom: 2px solid var(--gold); padding-bottom:10px;">Member Registration</h3>
                    <input type="text" id="new-mem-name" placeholder="Full Name">
                    <input type="text" id="new-mem-pass" placeholder="Password">
                    <button class="btn btn-tithe" style="width:100%" onclick="registerMember()">Register New Member</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const MEM_KEY = "abbc_v12_members";
        const REC_KEY = "abbc_v12_records";

        let members = JSON.parse(localStorage.getItem(MEM_KEY)) || [{name: 'Admin', pass: 'admin123', isAdmin: true}];
        let records = JSON.parse(localStorage.getItem(REC_KEY)) || [];
        let currentUser = null;

        function handleLogin() {
            const n = document.getElementById('log-name').value.trim();
            const p = document.getElementById('log-pass').value.trim();
            const user = members.find(m => m.name.toLowerCase() === n.toLowerCase() && m.pass === p);
            if(user) {
                currentUser = user;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                if(!user.isAdmin) document.querySelectorAll('.admin-only').forEach(e => e.classList.add('hidden'));
                updateUI();
            } else alert("Access Denied.");
        }

        function processEntry(category) {
            const name = document.getElementById('adm-member').value;
            const amt = parseFloat(document.getElementById('adm-amt').value);
            if(!amt || amt <= 0) return alert("Please enter a valid amount.");
            
            records.push({
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                name: name,
                type: category,
                amount: amt
            });
            
            localStorage.setItem(REC_KEY, JSON.stringify(records));
            document.getElementById('adm-amt').value = "";
            updateUI();
            alert(`‚Ç±${amt.toLocaleString()} saved to ${category} for ${name}`);
        }

        function downloadGivingCSV() {
            let csv = "Date,Category,Member Name,Amount\n";
            const visible = records.filter(r => currentUser.isAdmin || r.name === currentUser.name);
            visible.forEach(r => csv += `${r.date},${r.type},${r.name},${r.amount}\n`);
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', `ABBC_Financials_${new Date().toLocaleDateString()}.csv`);
            a.click();
        }

        function registerMember() {
            const name = document.getElementById('new-mem-name').value.trim();
            const pass = document.getElementById('new-mem-pass').value.trim();
            if(name && pass) {
                members.push({name, pass, isAdmin: false});
                localStorage.setItem(MEM_KEY, JSON.stringify(members));
                updateUI();
                alert("Member Registered Successfully.");
                document.getElementById('new-mem-name').value = "";
                document.getElementById('new-mem-pass').value = "";
            }
        }

        function showTab(t) {
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.add('hidden'));
            document.getElementById('tab-' + t).classList.remove('hidden');
        }

        function updateUI() {
            const mSel = document.getElementById('adm-member');
            const gBody = document.getElementById('giving-body');
            mSel.innerHTML = ""; gBody.innerHTML = "";
            
            members.forEach(m => { if(!m.isAdmin) mSel.innerHTML += `<option>${m.name}</option>`; });
            
            const visible = records.filter(r => currentUser.isAdmin || r.name === currentUser.name);
            visible.sort((a,b) => b.id - a.id).forEach(r => {
                gBody.innerHTML += `<tr><td>${r.date}</td><td><strong>${r.type}</strong></td><td>‚Ç±${r.amount.toLocaleString()}</td></tr>`;
            });
        }
    </script>
</body>
</html>
